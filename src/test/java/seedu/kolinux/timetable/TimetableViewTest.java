package seedu.kolinux.timetable;

import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import seedu.kolinux.exceptions.KolinuxException;
import seedu.kolinux.module.ModuleDb;
import seedu.kolinux.module.ModuleList;

import java.io.ByteArrayOutputStream;
import java.io.PrintStream;

import static org.junit.jupiter.api.Assertions.assertEquals;

public class TimetableViewTest {


    private static final String EMPTY_TIMETABLE = "+-------------+--------------------+--------------------"
            +
            "+--------------------+--------------------+--------------------+\n"
            +
            "|             |       MONDAY       |       TUESDAY      |      WEDNESDAY     |      THURSDAY      "
            +
            "|       FRIDAY       |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0600 - 0630  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0630 - 0700  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0700 - 0730  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0730 - 0800  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0800 - 0830  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0830 - 0900  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0900 - 0930  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0930 - 1000  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1000 - 1030  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1030 - 1100  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1100 - 1130  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1130 - 1200  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1200 - 1230  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1230 - 1300  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1300 - 1330  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1330 - 1400  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1400 - 1430  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1430 - 1500  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1500 - 1530  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1530 - 1600  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1600 - 1630  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1630 - 1700  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1700 - 1730  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1730 - 1800  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1800 - 1830  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------+"
            +
            "--------------------+\n"
            +
            "|1830 - 1900  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1900 - 1930  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1930 - 2000  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|2000 - 2030  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|2030 - 2100  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+";
    private static final String ONE_LESSON_IN_TIMETABLE = "+-------------+--------------------+--------------------"
            +
            "+--------------------+--------------------+--------------------+\n"
            +
            "|             |       MONDAY       |       TUESDAY      |      WEDNESDAY     |      THURSDAY      "
            +
            "|       FRIDAY       |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0600 - 0630  |     CS1231 TUT     |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0630 - 0700  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0700 - 0730  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0730 - 0800  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0800 - 0830  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0830 - 0900  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0900 - 0930  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0930 - 1000  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1000 - 1030  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1030 - 1100  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1100 - 1130  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1130 - 1200  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1200 - 1230  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1230 - 1300  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1300 - 1330  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1330 - 1400  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1400 - 1430  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1430 - 1500  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1500 - 1530  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1530 - 1600  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1600 - 1630  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1630 - 1700  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1700 - 1730  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1730 - 1800  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1800 - 1830  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------+"
            +
            "--------------------+\n"
            +
            "|1830 - 1900  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1900 - 1930  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1930 - 2000  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|2000 - 2030  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|2030 - 2100  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+";

    private static final String[] VALID_ADD_TUTORIAL_ARGUMENTS = new String[] {"CS1231", "TUT", "monday",
            "0600", "0630"};
    private static final ModuleDb moduleDb = new ModuleDb();
    private ModuleList moduleList = new ModuleList();
    private Timetable timetable = new Timetable(moduleList);
    private final ByteArrayOutputStream output = new ByteArrayOutputStream();
    private final PrintStream standardOut = System.out;


    @BeforeAll
    public static void initModuleDb() {
        moduleDb.initModuleDb();
    }

    @BeforeEach
    public void clear() {
        moduleList.clear();
    }

    @BeforeEach
    public void setUp() {
        System.setOut(new PrintStream(output));
    }

    @AfterEach
    public void tearDown() {
        System.setOut(standardOut);
    }

    @Test
    void viewTimetable_noLessonInTimetable_emptyTimetablePrinted() {
        timetable.clearTimetable();
        timetable.executeView();
        String expectedString = EMPTY_TIMETABLE.replaceAll("\\n|\\r\\n", System.getProperty("line.separator"));
        assertEquals(expectedString, output.toString().trim().replaceAll("\\n|\\r\\n",
                System.getProperty("line.separator")));
    }

    @Test
    void viewTimetable_oneLessonInTimetable_TimetablePrinted() throws KolinuxException {
        timetable.clearTimetable();
        moduleList.addModuleByCode("CS1231", moduleDb);
        timetable.executeAdd(VALID_ADD_TUTORIAL_ARGUMENTS);
        timetable.executeView();
        String expectedString = ONE_LESSON_IN_TIMETABLE.replaceAll("\\n|\\r\\n",
                System.getProperty("line.separator"));
        assertEquals(expectedString, output.toString().trim().replaceAll("\\n|\\r\\n",
                System.getProperty("line.separator")));
    }

}
